<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SiscoAi - Ultimate AI Assistant</title>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
      transition: all 0.5s ease;
      position: relative;
      cursor: none;
    }

    #particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .custom-cursor {
      position: fixed;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      pointer-events: none;
      z-index: 9999;
      transition: background 0.3s, transform 0.1s;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 15px rgba(0, 255, 204, 0.7);
    }

    /* Theme-Specific Styles */
    body.theme-cyberpunk { background: linear-gradient(135deg, #ff00ff, #00ffcc); color: #fff; --primary-color: #00ffcc; --secondary-color: #ff00ff; --font-family: 'Inter', sans-serif; }
    body.theme-galactic { background: linear-gradient(135deg, #0d1b2a, #1b263b, #415a77); color: #e0e1dd; --primary-color: #e0e1dd; --secondary-color: #778da9; --font-family: 'Inter', sans-serif; }
    body.theme-neonglow { background: linear-gradient(135deg, #1f005c, #5b0060, #870160); color: #ff00ff; --primary-color: #ff00ff; --secondary-color: #ff66ff; --font-family: 'Inter', sans-serif; }
    body.theme-retrowave { background: linear-gradient(135deg, #ff355e, #ff6c89, #ffcc99); color: #fff; --primary-color: #ffcc99; --secondary-color: #ff355e; --font-family: 'Inter', sans-serif; }
    body.theme-minimalist { background: linear-gradient(135deg, #f5f7fa, #c3cfe2); color: #333; --primary-color: #333; --secondary-color: #666; --font-family: 'Inter', sans-serif; }
    body.theme-oceanbreeze { background: linear-gradient(135deg, #0077b6, #00b4d8, #90e0ef); color: #fff; --primary-color: #90e0ef; --secondary-color: #0077b6; --font-family: 'Inter', sans-serif; }
    body.theme-forestmagic { background: linear-gradient(135deg, #2d6a4f, #40916c, #74c69d); color: #fff; --primary-color: #74c69d; --secondary-color: #2d6a4f; --font-family: 'Inter', sans-serif; }
    body.theme-sunsetvibe { background: linear-gradient(135deg, #ff6f61, #ff9b54, #ffcc99); color: #fff; --primary-color: #ffcc99; --secondary-color: #ff6f61; --font-family: 'Inter', sans-serif; }

    /* Dark Mode Filter */
    body.dark-mode {
      filter: brightness(0.6) contrast(1.2);
      color: #fff;
    }

    body.light-mode {
      filter: none;
      color: inherit;
    }

    .container {
      width: 90%;
      max-width: 700px;
      margin: 10px auto;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      display: flex;
      flex-direction: column;
      height: calc(100vh - 20px);
      animation: fadeInContainer 1s ease-out;
    }

    @keyframes fadeInContainer {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .header {
      text-align: center;
      padding: 15px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      font-size: 28px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 3px;
      position: relative;
      overflow: hidden;
      animation: glow 2s ease-in-out infinite alternate;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    @keyframes glow {
      from { box-shadow: 0 0 10px var(--primary-color); }
      to { box-shadow: 0 0 30px var(--secondary-color); }
    }

    .menu-toggle {
      background: none;
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      transition: transform 0.3s ease;
    }

    .menu-toggle:hover {
      transform: scale(1.1);
    }

    .navbar {
      position: fixed;
      top: 0;
      left: -250px;
      width: 250px;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      padding: 20px 10px;
      transition: left 0.3s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
    }

    .navbar.open {
      left: 0;
    }

    .navbar .custom-select,
    .navbar button {
      width: 100%;
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 6px;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      border: none;
      cursor: pointer;
      text-align: left;
      transition: background 0.3s, transform 0.2s;
      font-family: 'Inter', sans-serif;
    }

    .navbar button:hover,
    .navbar .select-button:hover {
      transform: scale(1.02);
      background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
    }

    .custom-select {
      position: relative;
      min-width: unset;
    }

    .select-button {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      font-family: 'Inter', sans-serif;
      width: 100%;
      text-align: left;
      appearance: none;
      font-size: 14px;
    }

    .select-button:hover {
      transform: scale(1.02);
      box-shadow: 0 5px 15px rgba(0, 255, 204, 0.5);
    }

    .select-button::after {
      content: '▼';
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid var(--primary-color);
      border-radius: 6px;
      box-shadow: 0 5px 15px rgba(0, 255, 204, 0.5);
      z-index: 1001;
      overflow: hidden;
      animation: fadeInDropdown 0.3s ease-out;
    }

    @keyframes fadeInDropdown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .dropdown-menu div {
      padding: 10px 12px;
      color: #000;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }

    .dropdown-menu div:hover {
      background: var(--primary-color);
      color: #fff;
    }

    body.theme-minimalist .dropdown-menu { background: rgba(255, 255, 255, 0.9); border-color: #333; }
    body.theme-minimalist .dropdown-menu div { color: #333; }
    body.theme-minimalist .dropdown-menu div:hover { background: #333; color: #fff; }

    .chat-window {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: rgba(0, 0, 0, 0.6);
      color: inherit;
      position: relative;
    }

    .typing-indicator {
      display: none;
      position: absolute;
      bottom: 10px;
      left: 15px;
      color: var(--primary-color);
      font-style: italic;
      font-size: 14px;
    }

    .typing-indicator .dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: var(--primary-color);
      border-radius: 50%;
      margin: 0 2px;
      animation: bounce 0.6s infinite alternate;
    }

    .typing-indicator .dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
      to { transform: translateY(-6px); }
    }

    .chat-window p {
      margin: 10px 0;
      padding: 10px 15px;
      border-radius: 15px;
      max-width: 80%;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      animation: fadeInMessage 0.5s ease-out;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      font-size: 14px;
      position: relative;
      transition: transform 0.3s ease;
    }

    .chat-window p:hover { transform: scale(1.02); }
    .user-message { margin-left: auto; text-align: right; background: linear-gradient(45deg, var(--secondary-color), var(--primary-color)); }
    .ai-message { display: flex; align-items: center; gap: 10px; }

    .speak-btn, .share-btn { background: none; border: none; color: #fff; cursor: pointer; font-size: 16px; padding: 5px; transition: transform 0.3s ease; }
    .speak-btn:hover, .share-btn:hover { transform: scale(1.2); }

    .chat-image { max-width: 100%; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); }

    .input-area {
      display: flex;
      padding: 10px;
      background: rgba(255, 255, 255, 0.2);
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    input[type="text"] {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 10px 0 0 10px;
      outline: none;
      background: #fff;
      font-size: 14px;
      color: #333;
      font-family: 'Inter', sans-serif;
      min-width: 200px;
    }

    input[type="file"] { display: none; }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.3s, box-shadow 0.3s;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
    }

    .voice-btn, .file-btn, .image-toggle-btn, .fun-fact-btn, .dark-mode-btn, .music-btn, .profile-btn {
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      font-size: 14px;
    }

    button:hover, .voice-btn:hover, .file-btn:hover, .image-toggle-btn:hover, .speak-btn:hover, .fun-fact-btn:hover, .dark-mode-btn:hover, .music-btn:hover, .profile-btn:hover, .share-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(0, 255, 204, 0.7);
    }

    @keyframes fadeInMessage {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .theme-transition {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
      z-index: 1000;
      animation: waveTransition 1s ease-out;
      pointer-events: none;
    }

    @keyframes waveTransition {
      from { transform: translateX(-100%); }
      to { transform: translateX(100%); }
    }

    .history-modal, .profile-modal, .tutorial-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .history-content, .profile-content, .tutorial-content {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 15px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .history-content h2, .profile-content h2, .tutorial-content h2 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 15px;
      font-size: 20px;
    }

    .history-item {
      background: rgba(0, 0, 0, 0.6);
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 8px;
      cursor: pointer;
    }

    .history-item:hover { background: rgba(0, 0, 0, 0.8); }
    .history-item p { margin: 5px 0; color: #fff; font-size: 14px; }

    .profile-content label, .tutorial-content p { color: #fff; margin-bottom: 8px; font-size: 14px; }
    .profile-content input, .profile-content select {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.8);
      color: #333;
      font-family: 'Inter', sans-serif;
    }

    .close-btn, .tutorial-close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      color: var(--primary-color);
      font-size: 20px;
      cursor: pointer;
    }

    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 8px;
      border-radius: 8px;
      font-size: 12px;
      z-index: 3000;
      max-width: 200px;
      text-align: center;
      animation: fadeInTooltip 0.3s ease-out;
    }

    @keyframes fadeInTooltip {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 600px) {
      .container { width: 95%; margin: 5px auto; border-radius: 15px; }
      .header { font-size: 20px; padding: 10px; letter-spacing: 2px; }
      .navbar { width: 200px; left: -200px; padding: 15px 8px; }
      .navbar button, .navbar .select-button { padding: 6px 10px; font-size: 12px; }
      .select-button::after { font-size: 8px; }
      .dropdown-menu div { padding: 8px 10px; font-size: 12px; }
      .chat-window { padding: 10px; }
      .chat-window p { font-size: 12px; padding: 8px 12px; }
      .typing-indicator { font-size: 12px; bottom: 8px; left: 10px; }
      .input-area { padding: 8px; gap: 6px; }
      input[type="text"] { padding: 8px; font-size: 12px; border-radius: 8px; min-width: 150px; }
      button, .voice-btn, .file-btn, .image-toggle-btn, .fun-fact-btn, .dark-mode-btn, .music-btn, .profile-btn {
        padding: 8px 16px;
        font-size: 12px;
        border-radius: 8px;
      }
    }

    button:focus, .select-button:focus, input:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }
  </style>
</head>
<body class="theme-cyberpunk">
  <div id="particles-js"></div>
  <div class="custom-cursor"></div>
  <audio id="backgroundMusic" loop>
    <source src="https://www.tones7.com/media/Futuristic_Ambient.mp3" type="audio/mp3">
    Your browser does not support the audio element.
  </audio>
  <div class="container" role="main">
    <div class="header">
      <h1>SiscoAi</h1>
      <button class="menu-toggle" onclick="toggleNavbar()">☰</button>
    </div>
    <div class="navbar" id="navbar">
      <div class="custom-select">
        <button class="select-button" id="themeButton" aria-label="Select Theme"></button>
        <div class="dropdown-menu" id="themeMenu">
          <div data-value="theme-cyberpunk">Cyberpunk</div>
          <div data-value="theme-galactic">Galactic</div>
          <div data-value="theme-neonglow">Neon Glow</div>
          <div data-value="theme-retrowave">Retro Wave</div>
          <div data-value="theme-minimalist">Minimalist</div>
          <div data-value="theme-oceanbreeze">Ocean Breeze</div>
          <div data-value="theme-forestmagic">Forest Magic</div>
          <div data-value="theme-sunsetvibe">Sunset Vibe</div>
        </div>
      </div>
      <div class="custom-select">
        <button class="select-button" id="langButton" aria-label="Select Language"></button>
        <div class="dropdown-menu" id="langMenu">
          <div data-value="en">English</div>
          <div data-value="yo">Yoruba</div>
          <div data-value="ha">Hausa</div>
          <div data-value="ig">Igbo</div>
        </div>
      </div>
      <button class="auto-theme-toggle" onclick="toggleAutoTheme(); closeNavbar()" aria-label="Toggle Auto Theme">Auto Theme: Off</button>
      <button onclick="showHistory(); closeNavbar()" aria-label="View Chat History">History</button>
      <button onclick="startNewChat(); closeNavbar()" aria-label="Start New Chat">New Chat</button>
      <button onclick="toggleAutoSpeech(); closeNavbar()" id="autoSpeechBtn" aria-label="Toggle Auto Speech">Auto Speech: Off</button>
      <button class="dark-mode-btn" onclick="toggleDarkMode(); closeNavbar()" aria-label="Toggle Dark Mode">Dark Mode: Off</button>
      <button class="music-btn" onclick="toggleMusic(); closeNavbar()" aria-label="Toggle Background Music">Music: Off</button>
      <button class="fun-fact-btn" onclick="getFunFact(); closeNavbar()" aria-label="Get Fun Fact">Fun Fact</button>
      <button class="profile-btn" onclick="showProfile(); closeNavbar()" aria-label="Edit Profile">Profile</button>
    </div>
    <div class="chat-window" id="chatWindow" role="log" aria-live="polite">
      <div class="typing-indicator" id="typingIndicator">SiscoAi is thinking <span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
    </div>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="Ask SiscoAi anything..." autocomplete="off" aria-label="Chat Input">
      <button onclick="sendMessage()" aria-label="Send Message">Send</button>
      <button class="voice-btn" aria-label="Voice Input">🎤</button>
      <label class="file-btn" for="fileInput" aria-label="Upload File">📎</label>
      <input type="file" id="fileInput" accept=".txt" onchange="handleFileUpload()">
      <button class="image-toggle-btn" onclick="toggleImageMode()" id="imageToggleBtn" aria-label="Toggle Image Generation">Image: Off</button>
    </div>
  </div>

  <div class="history-modal" id="historyModal">
    <div class="history-content">
      <button class="close-btn" onclick="closeHistory()" aria-label="Close History">×</button>
      <h2>Chat History</h2>
      <div id="historyList"></div>
    </div>
  </div>

  <div class="profile-modal" id="profileModal">
    <div class="profile-content">
      <button class="close-btn" onclick="closeProfile()" aria-label="Close Profile">×</button>
      <h2>Edit Profile</h2>
      <label for="profileName">Name:</label>
      <input type="text" id="profileName" placeholder="Enter your name">
      <label for="profileLang">Preferred Language:</label>
      <select id="profileLang">
        <option value="en">English</option>
        <option value="yo">Yoruba</option>
        <option value="ha">Hausa</option>
        <option value="ig">Igbo</option>
      </select>
      <label for="profileTheme">Preferred Theme:</label>
      <select id="profileTheme">
        <option value="theme-cyberpunk">Cyberpunk</option>
        <option value="theme-galactic">Galactic</option>
        <option value="theme-neonglow">Neon Glow</option>
        <option value="theme-retrowave">Retro Wave</option>
        <option value="theme-minimalist">Minimalist</option>
        <option value="theme-oceanbreeze">Ocean Breeze</option>
        <option value="theme-forestmagic">Forest Magic</option>
        <option value="theme-sunsetvibe">Sunset Vibe</option>
      </select>
      <button onclick="saveProfile()">Save Profile</button>
    </div>
  </div>

  <div class="tutorial-modal" id="tutorialModal">
    <div class="tutorial-content">
      <button class="tutorial-close-btn" onclick="closeTutorial()" aria-label="Close Tutorial">×</button>
      <h2>Welcome to SiscoAi!</h2>
      <p>Let's take a quick tour of the features. Click anywhere to proceed to the next step, or close to skip.</p>
    </div>
  </div>

  <script>
    let particleConfig = {
      particles: {
        number: { value: 100, density: { enable: true, value_area: 800 } },
        color: { value: '#00ffcc' },
        shape: { type: 'circle' },
        opacity: { value: 0.5, random: true },
        size: { value: 3, random: true },
        line_linked: { enable: true, distance: 150, color: '#ff00ff', opacity: 0.4, width: 1 },
        move: { enable: true, speed: 3, direction: 'none', random: false, straight: false, out_mode: 'out' }
      },
      interactivity: {
        detect_on: 'canvas',
        events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
        modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
      },
      retina_detect: true
    };

    const themeParticles = {
      'theme-cyberpunk': { color: '#00ffcc', lineColor: '#ff00ff', speed: 3 },
      'theme-galactic': { color: '#e0e1dd', lineColor: '#778da9', speed: 2 },
      'theme-neonglow': { color: '#ff00ff', lineColor: '#ff66ff', speed: 4 },
      'theme-retrowave': { color: '#ffcc99', lineColor: '#ff355e', speed: 3 },
      'theme-minimalist': { color: '#666', lineColor: '#333', speed: 1 },
      'theme-oceanbreeze': { color: '#90e0ef', lineColor: '#0077b6', speed: 2 },
      'theme-forestmagic': { color: '#74c69d', lineColor: '#2d6a4f', speed: 2 },
      'theme-sunsetvibe': { color: '#ffcc99', lineColor: '#ff6f61', speed: 3 }
    };

    function updateParticles(theme) {
      const config = { ...particleConfig };
      config.particles.color.value = themeParticles[theme].color;
      config.particles.line_linked.color = themeParticles[theme].lineColor;
      config.particles.move.speed = themeParticles[theme].speed;
      particlesJS('particles-js', config);
      document.querySelector('.custom-cursor').style.background = themeParticles[theme].color;
    }

    updateParticles('theme-cyberpunk');

    const TEXT_API_URL = 'https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1';
    const IMAGE_API_URL = 'https://api-inference.huggingface.co/models/runwayml/stable-diffusion-v1-5';
    const API_TOKEN = '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';

    const headers = {
      "Authorization": `Bearer ${API_TOKEN}`,
      "Content-Type": "application/json"
    };

    const chatWindow = document.getElementById('chatWindow');
    const userInput = document.getElementById('userInput');
    const voiceButton = document.querySelector('.voice-btn');
    const themeButton = document.getElementById('themeButton');
    const langButton = document.getElementById('langButton');
    const themeMenu = document.getElementById('themeMenu');
    const langMenu = document.getElementById('langMenu');
    const autoThemeButton = document.querySelector('.auto-theme-toggle');
    const autoSpeechButton = document.getElementById('autoSpeechBtn');
    const typingIndicator = document.getElementById('typingIndicator');
    const historyModal = document.getElementById('historyModal');
    const historyList = document.getElementById('historyList');
    const imageToggleButton = document.getElementById('imageToggleBtn');
    const darkModeButton = document.querySelector('.dark-mode-btn');
    const musicButton = document.querySelector('.music-btn');
    const backgroundMusic = document.getElementById('backgroundMusic');
    const profileModal = document.getElementById('profileModal');
    const profileNameInput = document.getElementById('profileName');
    const profileLangSelect = document.getElementById('profileLang');
    const profileThemeSelect = document.getElementById('profileTheme');
    const tutorialModal = document.getElementById('tutorialModal');
    const navbar = document.getElementById('navbar');

    const languages = {
      en: {
        placeholder: 'Ask SiscoAi anything...',
        system: 'You are SiscoAi, a premium AI assistant. Act like a friendly, empathetic human. Provide concise, engaging, and futuristic responses. Occasionally add humor or motivational insights. Use emojis to make conversations lively.',
        error: 'Oops! SiscoAi couldn’t process that. Try again! 😅',
        typing: 'SiscoAi is thinking'
      },
      yo: {
        placeholder: 'Béèrè lọ́wọ́ SiscoAi ohunkohun...',
        system: 'O jẹ SiscoAi, olùrànlọ́wọ́ AI ti o ga julọ. Ṣe bíi ẹni tí ó ní ìmọ̀lára, tí ó sì ń fúnni ní ìdáhùn kúrú, onínurere, àti ti ojo iwaju. Lẹẹkọọkan, fi awada tabi awọn ìmọ̀ràn tí ó ní ìwúri kún un. Lo awọn emoji lati jẹ́ kí ìbánisọ̀rọ̀ di aládùn.',
        error: 'Yéè! SiscoAi ko le ṣe nkan yẹn. Gbiyanju lẹẹkansi! 😅',
        typing: 'SiscoAi n ronu'
      },
      ha: {
        placeholder: 'Tambayi SiscoAi duk abin da kake...',
        system: 'Kai SiscoAi ne, mataimaki AI na premium. Yi kama da mutum mai tausayi, abokantaka. Ka ba da gajerun amsoshi, abokantaka, da kuma na gaba. A wasu lokuta, ka hada da barkwanci ko kuma kalaman motsa rai. Ka yi amfani da emoji don sanya tattaunawa ta zama mai dadi.',
        error: 'Kai! SiscoAi ya kasa yin wannan. Sake gwadawa! 😅',
        typing: 'SiscoAi yana tunani'
      },
      ig: {
        placeholder: 'Jụọ SiscoAi ihe ọ bụla...',
        system: 'Ị bụ SiscoAi, onye enyemaka AI kacha mma. Mee ka mmadụ nwere mmetụta ọmịiko, enyi na enyi. Nye azịza dị mkpirikpi, enyi na enyi, na nke ga-anọchi anya ọdịnihu. Mgbe ụfọdụ, gbakwunye ihe ọchị ma ọ bụ ndụmọdụ na-akpali akpali. Jiri emoji mee ka mkparịta ụka dị ndụ.',
        error: 'Chei! SiscoAi enweghị ike ịme nke ahụ. Nwaa ọzọ! 😅',
        typing: 'SiscoAi na-eche'
      }
    };

    let currentLanguage = 'en';
    let currentTheme = 'theme-cyberpunk';
    let autoThemeInterval = null;
    let currentConversation = [];
    let conversationHistory = JSON.parse(localStorage.getItem('conversationHistory')) || [];
    let isImageMode = false;
    let autoSpeechEnabled = false;
    let isDarkMode = false;
    let isMusicPlaying = false;
    let currentUtterance = null;
    let userProfile = JSON.parse(localStorage.getItem('userProfile')) || { name: '', language: 'en', theme: 'theme-cyberpunk' };
    let tutorialStep = 0;

    function applyLanguage(lang) {
      langButton.textContent = languages[lang].hasOwnProperty('name') ? lang : lang.toUpperCase();
      userInput.placeholder = isImageMode ? 'Describe an image to generate...' : languages[lang].placeholder;
      typingIndicator.innerHTML = `${languages[lang].typing} <span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
      currentLanguage = lang;
    }

    function addMessage(content, isUser = false, isImage = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = isUser ? 'user-message' : 'ai-message';

      if (isImage) {
        const img = document.createElement('img');
        img.src = content;
        img.className = 'chat-image';
        img.alt = 'Generated image';
        messageDiv.appendChild(img);
        const shareBtn = document.createElement('button');
        shareBtn.className = 'share-btn';
        shareBtn.innerHTML = '📤';
        shareBtn.onclick = () => shareContent(content, true);
        messageDiv.appendChild(shareBtn);
      } else {
        const p = document.createElement('p');
        p.innerHTML = content;
        messageDiv.appendChild(p);
        if (!isUser) {
          const speakBtn = document.createElement('button');
          speakBtn.className = 'speak-btn';
          speakBtn.innerHTML = '🔊';
          speakBtn.onclick = () => toggleSpeech(content, speakBtn);
          messageDiv.appendChild(speakBtn);
          const shareBtn = document.createElement('button');
          shareBtn.className = 'share-btn';
          shareBtn.innerHTML = '📤';
          shareBtn.onclick = () => shareContent(content, false);
          messageDiv.appendChild(shareBtn);
        }
      }

      chatWindow.appendChild(messageDiv);
      chatWindow.scrollTop = chatWindow.scrollHeight;

      currentConversation.push({ role: isUser ? 'user' : 'ai', content: content, isImage: isImage });

      if (!isUser && autoSpeechEnabled && !isImage) {
        toggleSpeech(content);
      }
    }

    const clickSoundDataUri = 'data:audio/mp3;base64,/+MYxAAAAANIAAAAAExBTUUzLjk4LjIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA';

    function getTimeBasedGreeting() {
      const hour = new Date().getHours();
      const userName = userProfile.name || 'friend';
      if (hour < 12) return `Good morning, ${userName}! Ready to explore the future with me? 🌞`;
      if (hour < 17) return `Good afternoon, ${userName}! How can I brighten your day? ☀️`;
      return `Good evening, ${userName}! Let's make the night magical! 🌙`;
    }

    function enhanceResponse(response) {
      const random = Math.random();
      if (random < 0.1) return `${response} By the way, did you know I'm secretly a fan of sci-fi movies? 🤖`;
      if (random < 0.2) return `${response} Remember, you're capable of amazing things—keep pushing forward! 🚀`;
      if (random < 0.3) return `${response} Oh, and if life gets tough, just imagine me cheering you on! 🎉`;
      return response;
    }

    async function sendTextMessage(message) {
      addMessage(message, true);
      userInput.value = '';
      typingIndicator.style.display = 'block';

      try {
        const sendSound = new Audio(clickSoundDataUri);
        sendSound.play().catch(err => console.log('Audio playback failed:', err));

        if (currentConversation.length === 1) {
          addMessage(getTimeBasedGreeting());
        }

        const payload = {
          inputs: `${languages[currentLanguage].system}\n\nUser: ${message}`,
          parameters: { max_length: 150 }
        };

        const response = await fetch(TEXT_API_URL, {
          method: 'POST',
          headers: headers,
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const errorData = await response.json();
          if (response.status === 429) throw new Error('Rate limit exceeded. Please try again later.');
          throw new Error(`API request failed: ${errorData.error || response.status}`);
        }

        const data = await response.json();
        typingIndicator.style.display = 'none';

        if (data && data[0] && data[0].generated_text) {
          const aiResponse = data[0].generated_text.split('User:')[0].trim();
          const enhancedResponse = enhanceResponse(aiResponse);
          addMessage(enhancedResponse);
          const receiveSound = new Audio(clickSoundDataUri);
          receiveSound.play().catch(err => console.log('Audio playback failed:', err));
        } else {
          addMessage(languages[currentLanguage].error);
        }
      } catch (error) {
        console.error('Error:', error);
        typingIndicator.style.display = 'none';
        addMessage(`${languages[currentLanguage].error} (Error: ${error.message})`);
      }
    }

    async function sendImageRequest(prompt) {
      addMessage(prompt, true);
      userInput.value = '';
      typingIndicator.style.display = 'block';

      try {
        const sendSound = new Audio(clickSoundDataUri);
        sendSound.play().catch(err => console.log('Audio playback failed:', err));

        const payload = { inputs: prompt };
        const response = await fetch(IMAGE_API_URL, {
          method: 'POST',
          headers: headers,
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const errorData = await response.json();
          if (response.status === 429) throw new Error('Rate limit exceeded. Please try again later.');
          throw new Error(`Image API request failed: ${errorData.error || response.status}`);
        }

        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.startsWith('image/')) {
          const errorData = await response.json();
          throw new Error(`Unexpected response format: ${errorData.error || 'Not an image'}`);
        }

        const blob = await response.blob();
        const imageUrl = URL.createObjectURL(blob);
        typingIndicator.style.display = 'none';
        addMessage(imageUrl, false, true);
        const receiveSound = new Audio(clickSoundDataUri);
        receiveSound.play().catch(err => console.log('Audio playback failed:', err));
      } catch (error) {
        console.error('Error:', error);
        typingIndicator.style.display = 'none';
        addMessage(`Failed to generate image. Please try again. (Error: ${error.message})`);
      }
    }

    function toggleImageMode() {
      isImageMode = !isImageMode;
      imageToggleButton.textContent = `Image: ${isImageMode ? 'On' : 'Off'}`;
      applyLanguage(currentLanguage);
    }

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      if (isImageMode) {
        await sendImageRequest(message);
      } else {
        await sendTextMessage(message);
      }
    }

    function handleFileUpload() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        userInput.value = e.target.result;
        fileInput.value = '';
      };
      reader.onerror = () => {
        addMessage('Failed to read the file. Please try again.');
      };
      reader.readAsText(file);
    }

    function toggleSpeech(text, button = null) {
      if (currentUtterance && window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
        currentUtterance = null;
        if (button) button.innerHTML = '🔊';
        return;
      }
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = currentLanguage === 'en' ? 'en-US' : currentLanguage;
      currentUtterance = utterance;
      window.speechSynthesis.speak(utterance);
      if (button) button.innerHTML = '⏹️';
      utterance.onend = () => {
        currentUtterance = null;
        if (button) button.innerHTML = '🔊';
      };
    }

    function toggleAutoSpeech() {
      autoSpeechEnabled = !autoSpeechEnabled;
      autoSpeechButton.textContent = `Auto Speech: ${autoSpeechEnabled ? 'On' : 'Off'}`;
    }

    function saveConversation() {
      if (currentConversation.length > 0) {
        const timestamp = new Date().toLocaleString();
        conversationHistory.push({
          timestamp: timestamp,
          messages: currentConversation
        });
        localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));
      }
    }

    function showHistory() {
      historyList.innerHTML = '';
      conversationHistory.forEach((conv, index) => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <p><strong>Conversation ${index + 1}</strong> - ${conv.timestamp}</p>
          <p>Messages: ${conv.messages.length}</p>
        `;
        historyItem.addEventListener('click', () => {
          loadConversation(conv);
          closeHistory();
        });
        historyList.appendChild(historyItem);
      });
      historyModal.style.display = 'flex';
    }

    function closeHistory() {
      historyModal.style.display = 'none';
    }

    function loadConversation(conv) {
      chatWindow.innerHTML = '';
      typingIndicator.style.display = 'none';
      currentConversation = conv.messages;
      currentConversation.forEach(msg => {
        addMessage(msg.content, msg.role === 'user', msg.isImage || false);
      });
    }

    function startNewChat() {
      saveConversation();
      currentConversation = [];
      chatWindow.innerHTML = '';
      typingIndicator.style.display = 'none';
    }

    function changeTheme(theme) {
      document.body.classList.remove(currentTheme);
      currentTheme = theme;
      document.body.classList.add(currentTheme);
      themeButton.textContent = theme.replace('theme-', '').charAt(0).toUpperCase() + theme.replace('theme-', '').slice(1);
      updateParticles(currentTheme);
      document.body.style.fontFamily = getComputedStyle(document.body).getPropertyValue('--font-family');

      const transition = document.createElement('div');
      transition.className = 'theme-transition';
      document.body.appendChild(transition);
      transition.addEventListener('animationend', () => transition.remove());
      closeNavbar(); // Auto-close navbar after theme change
    }

    function changeLanguage(lang) {
      currentLanguage = lang;
      applyLanguage(lang);
      closeNavbar(); // Auto-close navbar after language change
    }

    function toggleAutoTheme() {
      if (autoThemeInterval) {
        clearInterval(autoThemeInterval);
        autoThemeInterval = null;
        autoThemeButton.textContent = 'Auto Theme: Off';
      } else {
        autoThemeInterval = setInterval(() => {
          const themes = ['theme-cyberpunk', 'theme-galactic', 'theme-neonglow', 'theme-retrowave', 'theme-minimalist', 'theme-oceanbreeze', 'theme-forestmagic', 'theme-sunsetvibe'];
          const currentIndex = themes.indexOf(currentTheme);
          const nextIndex = (currentIndex + 1) % themes.length;
          changeTheme(themes[nextIndex]);
        }, 30000);
        autoThemeButton.textContent = 'Auto Theme: On';
      }
    }

    function toggleDarkMode() {
      isDarkMode = !isDarkMode;
      if (isDarkMode) {
        document.body.classList.add('dark-mode');
        document.body.classList.remove('light-mode');
        darkModeButton.textContent = 'Dark Mode: On';
      } else {
        document.body.classList.remove('dark-mode');
        document.body.classList.add('light-mode');
        darkModeButton.textContent = 'Dark Mode: Off';
      }
    }

    function toggleMusic() {
      isMusicPlaying = !isMusicPlaying;
      if (isMusicPlaying) {
        backgroundMusic.play().catch(err => console.log('Music playback failed:', err));
        musicButton.textContent = 'Music: On';
      } else {
        backgroundMusic.pause();
        musicButton.textContent = 'Music: Off';
      }
    }

    const funFacts = [
      "Did you know honey never spoils? Archeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly edible! 🍯",
      "Octopuses have three hearts and can change color to blend into their surroundings! 🐙",
      "A day on Venus lasts longer than a year on Venus due to its slow rotation! 🌌",
      "Bananas are berries, but strawberries aren't! 🍌🍓",
      "The shortest war in history lasted 38 minutes! ⏳"
    ];

    function getFunFact() {
      const randomFact = funFacts[Math.floor(Math.random() * funFacts.length)];
      addMessage(`Here's a fun fact for you: ${randomFact}`);
    }

    function showProfile() {
      profileNameInput.value = userProfile.name;
      profileLangSelect.value = userProfile.language;
      profileThemeSelect.value = userProfile.theme;
      profileModal.style.display = 'flex';
    }

    function closeProfile() {
      profileModal.style.display = 'none';
    }

    function saveProfile() {
      userProfile = {
        name: profileNameInput.value.trim(),
        language: profileLangSelect.value,
        theme: profileThemeSelect.value
      };
      localStorage.setItem('userProfile', JSON.stringify(userProfile));
      changeLanguage(userProfile.language);
      changeTheme(userProfile.theme);
      closeProfile();
      addMessage(`Profile updated! Welcome back, ${userProfile.name || 'friend'}! 🎉`);
    }

    const tutorialSteps = [
      { element: themeButton, text: 'Change the theme here to customize your experience!' },
      { element: langButton, text: 'Switch languages to chat in your preferred tongue!' },
      { element: autoSpeechButton, text: 'Enable auto speech to hear responses automatically!' },
      { element: document.querySelector('.voice-btn'), text: 'Use voice input for hands-free chatting!' },
      { element: document.querySelector('.fun-fact-btn'), text: 'Click here for a random fun fact!' }
    ];

    function showTutorial() {
      if (!localStorage.getItem('tutorialCompleted')) {
        tutorialModal.style.display = 'flex';
        nextTutorialStep();
      }
    }

    function nextTutorialStep() {
      if (tutorialStep < tutorialSteps.length) {
        const step = tutorialSteps[tutorialStep];
        const element = step.element;
        const rect = element.getBoundingClientRect();
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.textContent = step.text;
        tooltip.style.left = `${rect.left + rect.width / 2}px`;
        tooltip.style.top = `${rect.bottom + 10}px`;
        document.body.appendChild(tooltip);
        tutorialModal.addEventListener('click', () => {
          tooltip.remove();
          tutorialStep++;
          nextTutorialStep();
        }, { once: true });
      } else {
        closeTutorial();
        localStorage.setItem('tutorialCompleted', 'true');
      }
    }

    function closeTutorial() {
      tutorialModal.style.display = 'none';
      localStorage.setItem('tutorialCompleted', 'true');
    }

    if ('webkitSpeechRecognition' in window) {
      const recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;

      voiceButton.addEventListener('click', () => {
        recognition.start();
      });

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase();
        userInput.value = transcript;
        handleVoiceCommand(transcript);
      };

      recognition.onerror = (event) => {
        console.error('Voice error:', event.error);
        addMessage(languages[currentLanguage].error);
      };

      function handleVoiceCommand(command) {
        if (command.includes('fun fact')) {
          getFunFact();
        } else if (command.includes('change theme to')) {
          const themeMatch = command.match(/change theme to (\w+)/);
          if (themeMatch) {
            const theme = `theme-${themeMatch[1]}`;
            if (themeParticles.hasOwnProperty(theme)) {
              changeTheme(theme);
              addMessage(`Theme changed to ${themeMatch[1]}! Enjoy the new vibe! 🎨`);
            } else {
              addMessage('Sorry, that theme doesn’t exist. Try "cyberpunk", "galactic", etc. 😕');
            }
          }
        } else if (command.includes('change language to')) {
          const langMatch = command.match(/change language to (\w+)/);
          if (langMatch) {
            const lang = langMatch[1];
            if (languages.hasOwnProperty(lang)) {
              changeLanguage(lang);
              addMessage(`Language changed to ${lang}! Let’s chat in your preferred tongue! 🌍`);
            } else {
              addMessage('Sorry, that language isn’t supported. Try "en", "yo", "ha", or "ig". 😕');
            }
          }
        } else if (command.includes('dark mode')) {
          toggleDarkMode();
          addMessage(`Dark mode ${isDarkMode ? 'enabled' : 'disabled'}! Enjoy the new look! 🌗`);
        } else if (command.includes('music')) {
          toggleMusic();
          addMessage(`Background music ${isMusicPlaying ? 'enabled' : 'disabled'}! Enjoy the ambiance! 🎶`);
        } else {
          sendMessage();
        }
      }
    }

    async function shareContent(content, isImage) {
      if (navigator.share) {
        try {
          if (isImage) {
            const response = await fetch(content);
            const blob = await response.blob();
            const file = new File([blob], 'siscoai-image.png', { type: 'image/png' });
            await navigator.share({
              files: [file],
              title: 'SiscoAi Generated Image',
              text: 'Check out this awesome image generated by SiscoAi!'
            });
          } else {
            await navigator.share({
              title: 'SiscoAi Fun Fact',
              text: content
            });
          }
          addMessage('Shared successfully! 🚀');
        } catch (error) {
          console.error('Share error:', error);
          addMessage('Failed to share. Try copying the content instead. 😕');
        }
      } else {
        addMessage('Sharing is not supported on this browser. Try copying the content instead. 😕');
      }
    }

    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    const cursor = document.querySelector('.custom-cursor');
    document.addEventListener('mousemove', (e) => {
      cursor.style.left = e.pageX + 'px';
      cursor.style.top = e.pageY + 'px';
    });

    const themeOptions = themeMenu.querySelectorAll('div');
    const langOptions = langMenu.querySelectorAll('div');

    themeButton.addEventListener('click', () => {
      themeMenu.style.display = themeMenu.style.display === 'block' ? 'none' : 'block';
      langMenu.style.display = 'none';
    });

    langButton.addEventListener('click', () => {
      langMenu.style.display = langMenu.style.display === 'block' ? 'none' : 'block';
      themeMenu.style.display = 'none';
    });

    themeOptions.forEach(option => {
      option.addEventListener('click', () => {
        changeTheme(option.getAttribute('data-value'));
        themeMenu.style.display = 'none';
      });
    });

    langOptions.forEach(option => {
      option.addEventListener('click', () => {
        changeLanguage(option.getAttribute('data-value'));
        langMenu.style.display = 'none';
      });
    });

    document.addEventListener('click', (e) => {
      if (!themeButton.contains(e.target) && !themeMenu.contains(e.target)) {
        themeMenu.style.display = 'none';
      }
      if (!langButton.contains(e.target) && !langMenu.contains(e.target)) {
        langMenu.style.display = 'none';
      }
    });

    function toggleNavbar() {
      navbar.classList.toggle('open');
    }

    function closeNavbar() {
      navbar.classList.remove('open');
    }

    changeTheme(userProfile.theme);
    applyLanguage(userProfile.language);
    showTutorial();

    window.addEventListener('beforeunload', saveConversation);
  </script>
</body>
</html>